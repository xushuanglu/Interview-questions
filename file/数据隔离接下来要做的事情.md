### æ•°æ®éš”ç¦»æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…



#### 1ã€æ ‘æ ¹æ•°æ®éš”ç¦»é›†æˆæ–‡æ¡£å®Œå–„ï¼Œæ·»åŠ è·å–ç”¨æˆ·idï¼Œè·å–ç»„ç»‡idå‡½æ•°

#### 2ã€å’ŒETLå·¥ç¨‹å¸ˆå¯¹æ¥é›†æˆæ–¹æ¡ˆ

#### 3ã€rpcå±‚è·å–æ ‘æ ¹tokenä¿¡æ¯

#### 4ã€parsetree.goæ–‡ä»¶æ·»åŠ ç›¸åº”çš„redshiftä»£ç (æ·»åŠ æ–°åŠ çš„å‡½æ•°)

```go
"redshift": template.FuncMap{"funcPage": redshiftPage, "funcPrefix": prefix, "isNull": isNull},

"total": template.FuncMap{"funcPage": totalPage, "funcPrefix": prefix, "isNull": isNull},
```

#### 5ã€ç¼–å†™ç›¸åº”å‡½æ•°

æ­¥éª¤ï¼š

```
1ã€è·å–ç”¨æˆ·tokenä¿¡æ¯
2ã€é€šè¿‡ä»tokenä¸­è·å–çš„valueå€¼è¯·æ±‚æ ‘æ ¹æ¥å£åœ°å€
3ã€å°è£…è¿”å›æ•°æ®
```



### é¡¹ç›®ä¸­æ‰“å°logæ—¥å¿—

```go
utils.Logger.Debug("map:", params)
```



### é¡¹ç›®è·å–å‚æ•°

```go
å‡½æ•°å®šä¹‰ï¼šunc (c *Screen) Get(ctx context.Context, req *protobuf.Request) (*protobuf.Response, error) {}

è·å–å‚æ•°å€¼ï¼šreq.Args["corp_id"]
```

### ä»è¯·æ±‚ä¸­è·å–å‚æ•°

```go
request.Cookie["auth"] = c.Ctx.Request.Header.Get("auth")
```



### æ‰“å°æ—¥å¿—

```go
utils.Error("connectService.Ping error:", errors.WithStack(err))
```



### range ä½¿ç”¨ç”¨æ³•

```go
  data, err := ConnectorSchemaList(param)
	if err != nil {
		return false, err
	}

	for _, row := range data {
		if row["table_schem"] == c.schema {
			return true, nil
		}
	}
```



### appendä½¿ç”¨

```go
for _, info := range data {
		result = append(result, utils.ToString(info["name"]))
}
```



### utils.Pçš„ç”¨æ³•

```go
c.Data["json"] = utils.P{"code": 400, "msg": out}
```



### switch case çš„ç”¨æ³•

```go
switch index.(type) {
		case string, *string:
			_, err = m.findByObjectID(entity, index.(string)).Update(params)
		case int64, *int64:
			_, err = m.findByID(entity, index.(int64)).Update(params)
		case map[string]interface{}:
			_, err = m.findByFilters(entity, index.(map[string]interface{})).Update(params)
		case *orm.Condition:
			_, err = m.query(entity).SetCond(index.(*orm.Condition)).Delete()
		default:
}
```



### Git åˆå¹¶ä»£ç 

```shell
KEdeMac-mini:common.dh.cn datahunter$ git checkout iroot-saas
Switched to branch 'iroot-saas'
Your branch is up to date with 'origin/iroot-saas'.
KEdeMac-mini:common.dh.cn datahunter$ git merge enterprise-t
```



### Git åˆ é™¤æœ¬åœ°åˆ†æ”¯

```git
å‘½ä»¤è¡Œæ–¹å¼ï¼š

Git Bash:

    åˆ‡æ¢åˆ°è¦æ“ä½œçš„é¡¹ç›®æ–‡ä»¶å¤¹ 
    å‘½ä»¤è¡Œ : $ cd <ProjectPath>   ä¾‹å¦‚ï¼Œ$ cd /Downloads/G25_platform_sdk

    æŸ¥çœ‹é¡¹ç›®çš„åˆ†æ”¯ä»¬(åŒ…æ‹¬æœ¬åœ°å’Œè¿œç¨‹) 
    å‘½ä»¤è¡Œ : $ git branch -a     ä¾‹å¦‚ï¼Œ$ git branch -a 

    åˆ é™¤æœ¬åœ°åˆ†æ”¯ 
    å‘½ä»¤è¡Œ : $ git branch -d <BranchName>
```



### Git æ’¤é”€commitå’Œä¿®æ”¹çš„æ“ä½œ

1ã€æƒ³æ’¤é”€ä¹‹å‰çš„commitï¼Œå¹¶ä¸”èˆå¼ƒä¹‹å‰commitçš„ä¿®æ”¹

```powershell
git reset --hard HEAD^
```

2ã€æ’¤é”€ä¹‹å‰çš„commitï¼Œå¹¶ä¸”ä¿ç•™ä¹‹å‰çš„commitä¿®æ”¹

```powershell
git reset --soft HEAD^
```

3ã€git add å‘½ä»¤æäº¤åˆ°æš‚å­˜åŒºï¼Œgit reset HEAD demo1å°±æ˜¯æŠŠæäº¤åˆ°æš‚å­˜åŒºé‡Œçš„æ–‡ä»¶æ’¤é”€



### Git ä»£ç åˆå¹¶

```shell
git pull â€“rebase origin master
```



### Gitåˆå¹¶æ—¶é‡åˆ°å†²çªæˆ–é”™è¯¯åå–æ¶ˆåˆå¹¶

æ‰€ä»¥éœ€è¦å…ˆå–æ¶ˆè¿™æ¬¡åˆå¹¶ï¼Œä½¿ç”¨â€œgit merge --abortâ€å‘½ä»¤



### git ä¿®æ”¹æœ¬åœ°åŠè¿œç¨‹åˆ†æ”¯åç§°

```shell
git branch -m old_branch new_branch # Rename branch locally 
git push origin :old_branch # Delete the old branch 
git push --set-upstream origin new_branch # Push the new branch, set local branch to track the new remote
```



### Git ä½¿ç”¨ç‰ˆæœ¬å·

```shell
git version 2.20.1 (Apple Git-117)
```



### Git æŸ¥çœ‹æ–‡ä»¶å†…å®¹å’Œä¹‹å‰çš„ä¸åŒ

```shell
$ git diff readme.txt 
```



### Git logæ—¥å¿—æ‰“å°

`git log`å‘½ä»¤æ˜¾ç¤ºä»æœ€è¿‘åˆ°æœ€è¿œçš„æäº¤æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°3æ¬¡æäº¤ï¼Œæœ€è¿‘çš„ä¸€æ¬¡æ˜¯`append GPL`ï¼Œä¸Šä¸€æ¬¡æ˜¯`add distributed`ï¼Œæœ€æ—©çš„ä¸€æ¬¡æ˜¯`wrote a readme file`ã€‚

å¦‚æœå«Œè¾“å‡ºä¿¡æ¯å¤ªå¤šï¼Œçœ‹å¾—çœ¼èŠ±ç¼­ä¹±çš„ï¼Œå¯ä»¥è¯•è¯•åŠ ä¸Š`--pretty=oneline`å‚æ•°ï¼š

```shell
$ git log --pretty=oneline
1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -> master) append GPL
e475afc93c209a690c39c13a46716e8fa000c366 add distributed
eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0 wrote a readme file
```



### Git è®°å½•ä½ çš„æ¯ä¸€æ¬¡è®°å½•

```shell
$ git reflog
```



### Git  ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹

ä½ å¯ä»¥å‘ç°ï¼ŒGitä¼šå‘Šè¯‰ä½ ï¼Œ`git checkout -- file`å¯ä»¥ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹ï¼š

```
$ git checkout -- readme.txt
```

å‘½ä»¤`git checkout -- readme.txt`æ„æ€å°±æ˜¯ï¼ŒæŠŠ`readme.txt`æ–‡ä»¶åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹å…¨éƒ¨æ’¤é”€ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š

ä¸€ç§æ˜¯`readme.txt`è‡ªä¿®æ”¹åè¿˜æ²¡æœ‰è¢«æ”¾åˆ°æš‚å­˜åŒºï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°å’Œç‰ˆæœ¬åº“ä¸€æ¨¡ä¸€æ ·çš„çŠ¶æ€ï¼›

ä¸€ç§æ˜¯`readme.txt`å·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºåï¼Œåˆä½œäº†ä¿®æ”¹ï¼Œç°åœ¨ï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºåçš„çŠ¶æ€ã€‚

æ€»ä¹‹ï¼Œå°±æ˜¯è®©è¿™ä¸ªæ–‡ä»¶å›åˆ°æœ€è¿‘ä¸€æ¬¡`git commit`æˆ–`git add`æ—¶çš„çŠ¶æ€ã€‚



GitåŒæ ·å‘Šè¯‰æˆ‘ä»¬ï¼Œç”¨å‘½ä»¤`git reset HEAD `å¯ä»¥æŠŠæš‚å­˜åŒºçš„ä¿®æ”¹æ’¤é”€æ‰ï¼ˆunstageï¼‰ï¼Œé‡æ–°æ”¾å›å·¥ä½œåŒºï¼š

```
$ git reset HEAD readme.txt
Unstaged changes after reset:
M	readme.txt
```



### Git rmåˆ é™¤

ç°åœ¨ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€æ˜¯ç¡®å®è¦ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤è¯¥æ–‡ä»¶ï¼Œé‚£å°±ç”¨å‘½ä»¤`git rm`åˆ æ‰ï¼Œå¹¶ä¸”`git commit`ï¼š

```
$ git rm test.txt
rm 'test.txt'

$ git commit -m "remove test.txt"
[master d46f35e] remove test.txt
 1 file changed, 1 deletion(-)
 delete mode 100644 test.txt
```

å¦ä¸€ç§æƒ…å†µæ˜¯åˆ é”™äº†ï¼Œå› ä¸ºç‰ˆæœ¬åº“é‡Œè¿˜æœ‰å‘¢ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆè½»æ¾åœ°æŠŠè¯¯åˆ çš„æ–‡ä»¶æ¢å¤åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```
$ git checkout -- test.txt
```



### Git æ·»åŠ è¿œç¨‹ä»“åº“

```shell
$ git remote add origin git@github.com:michaelliao/learngit.git
```



```shell
git push origin master
```




### ç”¨æˆ·æ·»åŠ 

```go
user = new(models.DhUser)
user.Email = name
user.Name = name
user.Auth = utils.Md5(name, "", rand.Intn(1000)*rand.Intn(1000))
user.Level = 1
user.Status = 1
user.IsDataXUser = 1
user.Save()

info := userService.FormatUserInfo(user, true)
auth := userService.GetUserAuth(user)
info["auth"] = auth
services.GetLogService().SetLoginLog(user.ObjectId, "åå°", c.XRealIP(req))
return c.EchoJsonOk(info)
```



### ä»£ç è§„èŒƒï¼š

ç›¸åŒçš„å¤„ç†ä»£ç æ”¾åœ¨ä¸€èµ·ï¼Œä¸åŒçš„ä¸­é—´ç©ºä¸€è¡Œã€‚å°½é‡1ä¸ªifå¤„ç†å®Œé€»è¾‘

```go
//ç”¨æˆ·ç™»å½•
func (c *LoginController) Login() {
	name := c.GetString("name")
	password := c.GetString("password")
	if name == "" || password == "" {
		c.EchoErr(constants.ERR_USER_NAME_PASS)
		return
	}

	//æ ¡éªŒad: è¿”å›çŠ¶æ€  falseï¼šå¤±è´¥  trueï¼šæˆåŠŸ
	status := doAuth(name, password)
	if !status {
		c.EchoErr(constants.ERR_USER_NOT_MATCH)
		return
	}

	userService := services.GetUserService()
	user := userService.GetUserByEmail(name)
	if user == nil {
		user = userService.GetUserByMobile(name)
	}
	if user == nil {
		c.EchoErr(constants.ERR_USER_NAME_PASS)
		return
	}

	info := userService.FormatUserInfo(user, true)
	auth := userService.GetUserAuth(user)
	info["auth"] = auth
	c.EchoJsonOk(info)
}
```





### åˆ›å»ºé»˜è®¤æ—¶é—´ï¼š

```go
info["create_time"] = corp.CreateTime.Format("2006-01-02 15:04:05")
```



### formatæ ¼å¼åŒ–æ•°æ®

```go
auth := userService.GetUserAuth(user)
info := userService.FormatUserInfo(user, true)
```



### è¿”å›æˆåŠŸjsonæ•°æ®

#### ç›´æ¥è¿”å›

```go
c.EchoJsonOk(info)
```

 #### å…¶ä»–è¿”å›

```go
c.EchoJsonOk(utils.P{"_id": user.ObjectId})
```



### è¿”å›é”™è¯¯json

```go
c.EchoErr(constants.ERR_USER_NAME_PASS)
```



### ä½¿ç”¨service 

æ³¨ï¼šGetUserService()æ˜¯æ–¹æ³•

```go
userService := services.GetUserService()
```



### è·å–å‚æ•°

```go
c.Require(req.Args, "name", "type", "content")
name := c.GetString(req, "name")
_type := c.GetString(req, "type")
content := c.GetString(req, "content")
```



### golang è·å–å‚æ•°

æˆ‘ä»¬ç»å¸¸éœ€è¦è·å–ç”¨æˆ·ä¼ é€’çš„æ•°æ®ï¼ŒåŒ…æ‹¬ Getã€POST ç­‰æ–¹å¼çš„è¯·æ±‚ï¼Œbeego é‡Œé¢ä¼šè‡ªåŠ¨è§£æè¿™äº›æ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–æ•°æ®ï¼š

- GetString(key string) string
- GetStrings(key string) []string
- GetInt(key string) (int64, error)
- GetBool(key string) (bool, error)
- GetFloat(key string) (float64, error)

ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š

```go
func (this *MainController) Post() {
    jsoninfo := this.GetString("jsoninfo")
    if jsoninfo == "" {
        this.Ctx.WriteString("jsoninfo is empty")
        return
    }
}
```

å¦‚æœä½ éœ€è¦çš„æ•°æ®å¯èƒ½æ˜¯å…¶ä»–ç±»å‹çš„ï¼Œä¾‹å¦‚æ˜¯ int ç±»å‹è€Œä¸æ˜¯ int64ï¼Œé‚£ä¹ˆä½ éœ€è¦è¿™æ ·å¤„ç†ï¼š

```go
func (this *MainController) Post() {
    id := this.Input().Get("id")
    intid, err := strconv.Atoi(id)
}
```

æ›´å¤šå…¶ä»–çš„ request çš„ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ `this.Ctx.Request` è·å–ä¿¡æ¯ï¼Œå…³äºè¯¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å‚è€ƒæ‰‹å†Œ [Request](http://gowalker.org/net/http#Request)ã€‚



### golang ç›´æ¥è§£æåˆ°struct

å¦‚æœè¦æŠŠè¡¨å•é‡Œçš„å†…å®¹èµ‹å€¼åˆ°ä¸€ä¸ª struct é‡Œï¼Œé™¤äº†ç”¨ä¸Šé¢çš„æ–¹æ³•ä¸€ä¸ªä¸€ä¸ªè·å–å†èµ‹å€¼å¤–ï¼Œbeego æä¾›äº†é€šè¿‡å¦å¤–ä¸€ä¸ªæ›´ä¾¿æ·çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡ struct çš„å­—æ®µåæˆ– tag ä¸è¡¨å•å­—æ®µå¯¹åº”ç›´æ¥è§£æåˆ° structã€‚

å®šä¹‰ structï¼š

```go
type user struct {
    Id    int         `form:"-"`
    Name  interface{} `form:"username"`
    Age   int         `form:"age"`
    Email string
}
```

è¡¨å•ï¼š

```html
<form id="user">
    åå­—ï¼š<input name="username" type="text" />
    å¹´é¾„ï¼š<input name="age" type="text" />
    é‚®ç®±ï¼š<input name="Email" type="text" />
    <input type="submit" value="æäº¤" />
</form>
```

Controller é‡Œè§£æï¼š

```go
func (this *MainController) Post() {
    u := user{}
    if err := this.ParseForm(&u); err != nil {
        //handle error
    }
}
```

æ³¨æ„ï¼š

- StructTag form çš„å®šä¹‰å’Œ [renderformæ–¹æ³•](https://beego.me/docs/mvc/view/view.md#renderform-ä½¿ç”¨) å…±ç”¨ä¸€ä¸ªæ ‡ç­¾
- å®šä¹‰ struct æ—¶ï¼Œå­—æ®µååå¦‚æœæœ‰ form è¿™ä¸ª tagï¼Œåˆ™ä¼šä»¥æŠŠ form è¡¨å•é‡Œçš„ name å’Œ tag çš„åç§°ä¸€æ ·çš„å­—æ®µèµ‹å€¼ç»™è¿™ä¸ªå­—æ®µï¼Œå¦åˆ™å°±ä¼šæŠŠ form è¡¨å•é‡Œä¸å­—æ®µåä¸€æ ·çš„è¡¨å•å†…å®¹èµ‹å€¼ç»™è¿™ä¸ªå­—æ®µã€‚å¦‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œä¼šæŠŠè¡¨å•ä¸­çš„ username å’Œ age åˆ†åˆ«èµ‹å€¼ç»™ user é‡Œçš„ Name å’Œ Age å­—æ®µï¼Œè€Œ Email é‡Œçš„å†…å®¹åˆ™ä¼šèµ‹ç»™ Email è¿™ä¸ªå­—æ®µã€‚
- è°ƒç”¨ Controller ParseForm è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸ºä¸€ä¸ª struct çš„æŒ‡é’ˆï¼Œå¦åˆ™å¯¹ struct çš„èµ‹å€¼ä¸ä¼šæˆåŠŸå¹¶è¿”å› `xx must be a struct pointer` çš„é”™è¯¯ã€‚
- å¦‚æœè¦å¿½ç•¥ä¸€ä¸ªå­—æ®µï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼Œä¸€æ˜¯ï¼šå­—æ®µåå°å†™å¼€å¤´ï¼ŒäºŒæ˜¯ï¼š`form` æ ‡ç­¾çš„å€¼è®¾ç½®ä¸º `-`



### golang è·å–Request Bodyé‡Œçš„å†…å®¹

åœ¨ API çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ° `JSON` æˆ– `XML` æ¥ä½œä¸ºæ•°æ®äº¤äº’çš„æ ¼å¼ï¼Œå¦‚ä½•åœ¨ beego ä¸­è·å– Request Body é‡Œçš„ JSON æˆ– XML çš„æ•°æ®å‘¢ï¼Ÿ

1. åœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½® `copyrequestbody = true`
2. åœ¨ Controller ä¸­

```go
func (this *ObjectController) Post() {
    var ob models.Object
    var err error
    if err = json.Unmarshal(this.Ctx.Input.RequestBody, &ob); err == nil {
        objectid := models.AddOne(ob)
        this.Data["json"] = "{\"ObjectId\":\"" + objectid + "\"}"
    } else {
        this.Data["json"] = err.Error()
    }
    this.ServeJSON()
}
```

 

### golang æ•°æ®ç»‘å®š

æ”¯æŒä»ç”¨æˆ·è¯·æ±‚ä¸­ç›´æ¥æ•°æ® bind åˆ°æŒ‡å®šçš„å¯¹è±¡,ä¾‹å¦‚è¯·æ±‚åœ°å€å¦‚ä¸‹

```go
?id=123&isok=true&ft=1.2&ol[0]=1&ol[1]=2&ul[]=str&ul[]=array&user.Name=astaxie
var id int
this.Ctx.Input.Bind(&id, "id")  //id ==123

var isok bool
this.Ctx.Input.Bind(&isok, "isok")  //isok ==true

var ft float64
this.Ctx.Input.Bind(&ft, "ft")  //ft ==1.2

ol := make([]int, 0, 2)
this.Ctx.Input.Bind(&ol, "ol")  //ol ==[1 2]

ul := make([]string, 0, 2)
this.Ctx.Input.Bind(&ul, "ul")  //ul ==[str array]

user struct{Name}
this.Ctx.Input.Bind(&user, "user")  //user =={Name:"astaxie"}
```



### golang è‡ªå®šä¹‰è¡¨å

```go
type User struct {
    Id int
    Name string
}

func (u *User) TableName() string {
    return "auth_user"
}
```

**å¦‚æœ[å‰ç¼€è®¾ç½®](https://beego.me/docs/mvc/model/orm.md#registermodelwithprefix)ä¸º `prefix_` é‚£ä¹ˆè¡¨åä¸ºï¼šprefix_auth_user**



### golang è‡ªå®šä¹‰ç´¢å¼•

ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—æ®µå¢åŠ ç´¢å¼•

```go
type User struct {
    Id    int
    Name  string
    Email string
}

// å¤šå­—æ®µç´¢å¼•
func (u *User) TableIndex() [][]string {
    return [][]string{
        []string{"Id", "Name"},
    }
}

// å¤šå­—æ®µå”¯ä¸€é”®
func (u *User) TableUnique() [][]string {
    return [][]string{
        []string{"Name", "Email"},
    }
}
```



### golang è‡ªå®šä¹‰å¼•æ“

ä»…æ”¯æŒ MySQL

é»˜è®¤ä½¿ç”¨çš„å¼•æ“ï¼Œä¸ºå½“å‰æ•°æ®åº“çš„é»˜è®¤å¼•æ“ï¼Œè¿™ä¸ªæ˜¯ç”±ä½ çš„ mysql é…ç½®å‚æ•°å†³å®šçš„ã€‚

ä½ å¯ä»¥åœ¨æ¨¡å‹é‡Œè®¾ç½® TableEngine å‡½æ•°ï¼ŒæŒ‡å®šä½¿ç”¨çš„å¼•æ“

```go
type User struct {
    Id    int
    Name  string
    Email string
}

// è®¾ç½®å¼•æ“ä¸º INNODB
func (u *User) TableEngine() string {
    return "INNODB"
}
```





### golangäº‹åŠ¡

```go
o := new(models.DhBase).Orm()
	err := o.Begin()
	if err != nil {
		utils.Error("ApplyCorpå¼€å¯äº‹åŠ¡å¤±è´¥")
		return false, nil
	}
	corp := new(models.DhCorp)
	corp.Name = name
	corp.Email = email
	corp.Mobile = mobile
	corp.Vcode = vcode
	corp.Status = constants.CORP_STATUS_NEW
	ok := corp.Save()
	if !ok {
		utils.Error("ApplyCorpæ–°å¢å›¢é˜Ÿå¤±è´¥")
		o.Rollback()
		return false, nil
	}
	userCorp := new(models.DhUserCorp)
	userCorp.UserId = userID
	userCorp.CorpId = corp.ObjectId
	userCorp.Role = constants.USER_CORP_ROLE_ADMIN
	ok = userCorp.Save()
	if !ok {
		utils.Error("ApplyCorpä¿å­˜å›¢é˜Ÿæˆå‘˜å¤±è´¥")
		o.Rollback()
		return false, nil
	}
	vcodeService := GetVcodeService()
	_vcode := vcodeService.GetVcode(mobile, vcode)
	if _vcode != nil {
		ok = vcodeService.SetUsed(_vcode)
	}
	if !ok {
		utils.Error("ApplyCorpè®¾ç½®éªŒè¯ç ä¸ºå·²ç»ä½¿ç”¨å¤±è´¥")
		o.Rollback()
		return false, nil
	}
	err = o.Commit()
	if err != nil {
		utils.Error("ApplyCorpæäº¤äº‹åŠ¡å¤±è´¥")
		return false, nil
	}
	return true, corp
```



### golangåˆ¤æ–­æ•°å€¼æ•°é‡

```go
if len(corpUser) > 0 {}
```



### golangæŸ¥è¯¢sqlè¯­å¥

```go
userList := new(models.DhUserCorp).List(map[string]interface{}{"corp_id": corp.ObjectId})

countfilter := utils.P{}
countfilter["corp_id"] = corp.ObjectId
CropCount := new(models.DhUserCorp).Count(countfilter)
```



golang æ·»åŠ ç­›é€‰å­—æ®µ

```go
cond := orm.NewCondition()
	mpurl := "/admin/customer/list?"
	if search != "" {
		mpurl = mpurl + "&search=" + search
		conde := orm.NewCondition()
		conde = conde.Or("name__icontains", search).Or("corp__icontains", search).Or("email__icontains", search).Or("mobile__icontains", search)
		cond = cond.AndCond(conde)
	}
	if beginTime != "" {
		mpurl = mpurl + "&begin_time=" + beginTime
		cond = cond.And("create_time__gte", beginTime+" 00:00:00")
	}
	if endTime != "" {
		mpurl = mpurl + "&end_time=" + endTime
		cond = cond.And("create_time__lt", endTime+" 23:59:59")
	}
cond = cond.And("status", 1)
```



### golang ä¿å­˜å•ä¸ªæ•°æ®

```go
dashboardGroup := new(models.DiDashboardGroup)
dashboardGroup.Name = name
//ä¿å­˜çœ‹æ¿ç»„
ok := dashboardGroup.Save()
	if !ok {
		utils.Error("ä¿å­˜çœ‹æ¿ç»„å¤±è´¥")
		o.Rollback()
		return false, nil
}
```



### golang for ç”¨æ³•

```go
//å–æ¶ˆå›¢é˜Ÿå…±äº«
relations := relationService.GetShareList(constants.TYPE_DASHBOARD_GROUP, dashboardGroup.ObjectId, constants.AUTH_SHARE)
	if len(relations) > 0 {
			for _, relation := range relations {
				shareUserIDs = append(shareUserIDs, relation.UserId)
				//åˆ é™¤å…³è”å…³ç³»
				ok := relation.Delete(relation.ObjectId)
				if !ok {
					utils.Error("åˆ é™¤çœ‹æ¿åˆ†ç»„å›¢é˜Ÿå…±äº«å…³è”å…³ç³»å¤±è´¥")
					o.Rollback()
					return false
			}
		}
}
```



### golang  *RelationServiceçš„ä½¿ç”¨

```go
func GetRelationService() *RelationService {
	return &RelationService{}
}

relationService := GetRelationService()
ownerRelation := relationService.GetOwnerRelation(constants.TYPE_DASHBOARD, dashboard.ObjectId)
```



### golang  redisåˆ é™¤key

```go
cacheKey := fmt.Sprintf("datasource:%v", dataSourceID)
err := caches.RedisRemove(cacheKey)
if err != nil {
	utils.Error("åˆ é™¤å·¥ä½œè¡¨ç¼“å­˜å¤±è´¥:", err.Error(), cacheKey)
}
```



### golang  utils.AbsolutePath

```go
path := utils.AbsolutePath(convertFilepath)
```



### golang md5åŠ å¯†ğŸ”

```go
user.Password = utils.Md5(password, constants.Md5Salt)
```



### golang åˆ†é¡µ

```go
new(models.DhIcode).Query().Offset((page - 1) * pageSize).Limit(pageSize).SetCond(cond).OrderBy("-create_time").All(&list)
```



### golang  ç”Ÿæˆéšæœºå­—ç¬¦ä¸²

```go
code := utils.GetRandomString(5)
```



### golang å°è£…httpè¯·æ±‚åœ°å€

```go
url := fmt.Sprintf("%s/deviceFilter/devices?orgId=%s&modelType=%d", constants.IROOT_HOST, c.OrgId, modelType)
```





### golang å®šä¹‰varå˜é‡

```go
var (
    NotPV []string = []string{"css", "js", "class", "gif", "jpg", "jpeg", "png", "bmp", "ico", "rss", "xml", "swf"}
)
```



### golang beego è·å–conf/app.confé…ç½®æ–‡ä»¶çš„å‚æ•°å€¼

ä½ ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®åº”ç”¨éœ€è¦ç”¨çš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸‹é¢æ‰€ç¤ºçš„æ•°æ®åº“ä¿¡æ¯ï¼š

```go
mysqluser = "root"
mysqlpass = "rootpass"
mysqlurls = "127.0.0.1"
mysqldb   = "beego"
```

é‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼è·å–è®¾ç½®çš„é…ç½®ä¿¡æ¯:

```go
beego.AppConfig.String("mysqluser")
beego.AppConfig.String("mysqlpass")
beego.AppConfig.String("mysqlurls")
beego.AppConfig.String("mysqldb")
```



### golang beegoä¸åŒçº§åˆ«çš„é…ç½®

åœ¨é…ç½®æ–‡ä»¶é‡Œé¢æ”¯æŒ sectionï¼Œå¯ä»¥æœ‰ä¸åŒçš„ Runmode çš„é…ç½®ï¼Œé»˜è®¤ä¼˜å…ˆè¯»å– runmode ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸‹é¢çš„é…ç½®æ–‡ä»¶ï¼š

```go
appname = beepkg
httpaddr = "127.0.0.1"
httpport = 9090
runmode ="dev"
autorender = false
recoverpanic = false
viewspath = "myview"

[dev]
httpport = 8080
[prod]
httpport = 8088
[test]
httpport = 8888
```

ä¸Šé¢çš„é…ç½®æ–‡ä»¶å°±æ˜¯åœ¨ä¸åŒçš„ runmode ä¸‹è§£æä¸åŒçš„é…ç½®ï¼Œä¾‹å¦‚åœ¨ dev æ¨¡å¼ä¸‹ï¼Œhttpport æ˜¯ 8080ï¼Œåœ¨ prod æ¨¡å¼ä¸‹æ˜¯ 8088ï¼Œåœ¨ test æ¨¡å¼ä¸‹æ˜¯ 8888ã€‚å…¶ä»–é…ç½®æ–‡ä»¶åŒç†ã€‚è§£æçš„æ—¶å€™ä¼˜å…ˆè§£æ runmode ä¸‹çš„é…ç½®ï¼Œç„¶åè§£æé»˜è®¤çš„é…ç½®ã€‚

è¯»å–ä¸åŒæ¨¡å¼ä¸‹é…ç½®å‚æ•°çš„æ–¹æ³•æ˜¯â€œæ¨¡å¼::é…ç½®å‚æ•°åâ€ï¼Œæ¯”å¦‚ï¼šbeego.AppConfig.String(â€œdev::mysqluserâ€)ã€‚

å¯¹äºè‡ªå®šä¹‰çš„å‚æ•°ï¼Œéœ€ä½¿ç”¨ beego.GetConfig(typ, key string, defaultVal interface{}) æ¥è·å–æŒ‡å®š runmode ä¸‹çš„é…ç½®ï¼ˆéœ€ 1.4.0 ä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼Œtyp ä¸ºå‚æ•°ç±»å‹ï¼Œkey ä¸ºå‚æ•°å, defaultVal ä¸ºé»˜è®¤å€¼ã€‚



### golang beegoå¤šä¸ªé…ç½®æ–‡ä»¶

INI æ ¼å¼é…ç½®æ”¯æŒ `include` æ–¹å¼ï¼Œå¼•ç”¨å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ•ˆæœåŒä¸Šï¼š

app.conf

```go
appname = beepkg
httpaddr = "127.0.0.1"
httpport = 9090

include "app2.conf"
```

app2.conf

```go
runmode ="dev"
autorender = false
recoverpanic = false
viewspath = "myview"

[dev]
httpport = 8080
[prod]
httpport = 8088
[test]
httpport = 8888
```

### 

### golang  okçš„ä½¿ç”¨

```go
type NestPreparer interface {
        NestPrepare()
}

// baseRouter implemented global settings for all other routers.
type baseController struct {
        beego.Controller
        i18n.Locale
        user    models.User
        isLogin bool
}
// Prepare implemented Prepare method for baseRouter.
func (this *baseController) Prepare() {

        // page start time
        this.Data["PageStartTime"] = time.Now()

        // Setting properties.
        this.Data["AppDescription"] = utils.AppDescription
        this.Data["AppKeywords"] = utils.AppKeywords
        this.Data["AppName"] = utils.AppName
        this.Data["AppVer"] = utils.AppVer
        this.Data["AppUrl"] = utils.AppUrl
        this.Data["AppLogo"] = utils.AppLogo
        this.Data["AvatarURL"] = utils.AvatarURL
        this.Data["IsProMode"] = utils.IsProMode

        if app, ok := this.AppController.(NestPreparer); ok {
                app.NestPrepare()
        }
}
```



### golang æå‰ç»ˆæ­¢è¿è¡Œ

æˆ‘ä»¬åº”ç”¨ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œåœ¨ Prepare é˜¶æ®µè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·è®¤è¯ä¸é€šè¿‡ï¼Œå°±è¾“å‡ºä¸€æ®µä¿¡æ¯ï¼Œç„¶åç›´æ¥ä¸­æ­¢è¿›ç¨‹ï¼Œä¹‹åçš„ Postã€Get ä¹‹ç±»çš„ä¸å†æ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•ç»ˆæ­¢å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ `StopRun` æ¥ç»ˆæ­¢æ‰§è¡Œé€»è¾‘ï¼Œå¯ä»¥åœ¨ä»»æ„çš„åœ°æ–¹æ‰§è¡Œã€‚

```go
type RController struct {
    beego.Controller
}

func (this *RController) Prepare() {
    this.Data["json"] = map[string]interface{}{"name": "astaxie"}
    this.ServeJSON()
    this.StopRun()
}
```

> > > è°ƒç”¨ StopRun ä¹‹åï¼Œå¦‚æœä½ è¿˜å®šä¹‰äº† Finish å‡½æ•°å°±ä¸ä¼šå†æ‰§è¡Œï¼Œå¦‚æœéœ€è¦é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆè¯·è‡ªå·±åœ¨è°ƒç”¨ StopRun ä¹‹å‰æ‰‹å·¥è°ƒç”¨ Finish å‡½æ•°ã€‚



### golang  beegoåœ¨è¡¨å•ä¸­ä½¿ç”¨PUTæ–¹æ³•

é¦–å…ˆè¦è¯´æ˜, åœ¨ XHTML 1.x æ ‡å‡†ä¸­, è¡¨å•åªæ”¯æŒ GET æˆ–è€… POST æ–¹æ³•. è™½ç„¶è¯´æ ¹æ®æ ‡å‡†, ä½ ä¸åº”è¯¥å°†è¡¨å•æäº¤åˆ° PUT æ–¹æ³•, ä½†æ˜¯å¦‚æœä½ çœŸæƒ³çš„è¯, ä¹Ÿå¾ˆå®¹æ˜“, é€šå¸¸å¯ä»¥è¿™ä¹ˆåš:

é¦–å…ˆè¡¨å•æœ¬èº«è¿˜æ˜¯ä½¿ç”¨ POST æ–¹æ³•æäº¤, ä½†æ˜¯å¯ä»¥åœ¨è¡¨å•ä¸­æ·»åŠ ä¸€ä¸ªéšè—å­—æ®µ:

```html
<form method="post" ...>
  <input type="hidden" name="_method" value="put" />
```

æ¥ç€åœ¨ Beego ä¸­æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨æ¥åˆ¤æ–­æ˜¯å¦å°†è¯·æ±‚å½“åš PUT æ¥è§£æ:

```go
var FilterMethod = func(ctx *context.Context) {
    if ctx.BeegoInput.Query("_method")!="" && ctx.BeegoInput.IsPost(){
          ctx.Request.Method = ctx.BeegoInput.Query("_method")
    }
}

beego.InsertFilter("*", beego.BeforeRouter, FilterMethod)
```



### golang  å®šä¹‰struct å’Œä½¿ç”¨

```go
type ALiYun struct {
	AccessId  string
	AccessKey string
}

func NewALiYun() *ALiYun {
	return &ALiYun{
		AccessId:  constants.ALIYUN_SMS_ACCESS_ID,
		AccessKey: constants.ALIYUN_SMS_ACCESS_KEY,
	}
}
```



### golang è§£å†³è·¨åŸŸé—®é¢˜

```go
beego.InsertFilter("*", beego.BeforeRouter, cors.Allow(&cors.Options{
		// AllowAllOrigins:  true,
		AllowMethods:     []string{"*"},
		AllowHeaders:     []string{"Origin", "Authorization", "Access-Control-Allow-Origin", "dhref"},
		ExposeHeaders:    []string{"Content-Length", "Access-Control-Allow-Origin"},
		AllowCredentials: true,
		AllowOrigins:     []string{"http://shugen-max.beta.datahunter.cn",  "http://192.168.1.196:*"},
	}))
```



### golang æˆªå–åŸŸåä¹‹åçš„å­—ç¬¦ä¸²

```go
c.Require(req.Args, "url")
url := c.GetString(req, "url")
if strings.HasPrefix(url, "http://") {
	if tmp := strings.SplitN(url, `/`, 4); len(tmp) > 3 {
		url = tmp[3]
	}
}

```



### golang ormä½¿ç”¨ 
å‚è€ƒåœ°å€ï¼š[https://beego.me/docs/mvc/model/query.md]()

```go
filter := map[string]interface{}{
		"url__iendswithi": url,
}
return new(models.DxLinkshare).Find(filter)
```





### golang  ä¼ å‚æ•°

```go
frequency := fmt.Sprintf("TZ=Asia/Shanghai %s %s %s * * *", spec[2], spec[1], spec[0])
		sche, err := cron.Parse(frequency)
		if err != nil {
			return fmt.Errorf("é…ç½®å¼‚å¸¸:[%v:%v]", md5, job.Spec)
		}
```



### golang åˆ¤æ–­æ˜¯ä¸æ˜¯æ•´å‹ utils.IsInt()

```go
if !utils.IsInt(spec[i]) {
		return fmt.Errorf("é…ç½®å¼‚å¸¸:[%v:%v]", md5, job.Spec)
}
```



### golang å°è£…å‚æ•°

```go
filters := map[string]interface{}{
		"corp_id": corpID,
		"user_id": userID,
}
```



### golang ormåˆ†é¡µ

```go
new(models.DhUser).Query().Offset((page - 1) * pageSize).Limit(pageSize).SetCond(cond).OrderBy("-create_time").All(&list)
```



### golang åˆ›å»ºormç­›é€‰æ¡ä»¶

```go
conde := orm.NewCondition()
		conde = conde.Or("name__icontains", search).Or("corp__icontains", 	    search).Or("email__icontains", search).Or("mobile__icontains", search)
		cond = cond.AndCond(conde)
```

